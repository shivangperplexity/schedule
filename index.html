<!DOCTYPE html>
<html lang="mr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡§¶‡•å‡§∞‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ - ‡§Ü. ‡§µ‡§ø‡§∂‡•ç‡§µ‡§ú‡•Ä‡§§ ‡§ï‡§¶‡§Æ</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

  <header>
    ‡§Ü. ‡§µ‡§ø‡§∂‡•ç‡§µ‡§ú‡•Ä‡§§ ‡§ï‡§¶‡§Æ
  </header>

  <div class="container">
    <h2>‡§¶‡•å‡§∞‡§æ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ</h2>

    <!-- ‡§∂‡•ã‡§ß ‡§µ ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ -->
    <div class="filter-box">
      <input type="text" id="searchInput" placeholder="‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§∂‡•ã‡§ß‡§æ (‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï, ‡§†‡§ø‡§ï‡§æ‡§£, ‡§µ‡§ø‡§µ‡§∞‡§£)">
      <input type="date" id="dateFilter">
      <button id="clearBtn">‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§æ‡§¢‡§æ</button>
    </div>

    <!-- ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ -->
    <div id="events"></div>
  </div>

  <footer>
    ¬© ‡•®‡•¶‡•®‡•´ ‡§Ü. ‡§µ‡§ø‡§∂‡•ç‡§µ‡§ú‡•Ä‡§§ ‡§ï‡§¶‡§Æ | ‡§∏‡§∞‡•ç‡§µ ‡§π‡§ï‡•ç‡§ï ‡§∞‡§æ‡§ñ‡•Ä‡§µ
  </footer>

  <script>
    async function loadEvents() {
      const repo = "YOUR_GITHUB_USERNAME/doura-karyakram"; // üëâ ‡§á‡§•‡•á ‡§§‡•Å‡§Æ‡§ö‡§æ GitHub repo ‡§ü‡§æ‡§ï‡§æ
      const branch = "main";

      const res = await fetch(`https://api.github.com/repos/${repo}/contents/events?ref=${branch}`);
      if (!res.ok) {
        document.getElementById("events").innerHTML = "<p>‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§æ‡§π‡•Ä‡§§.</p>";
        return;
      }

      const files = await res.json();
      let events = [];

      for (let file of files) {
        if (file.name.endsWith(".md")) {
          const raw = await fetch(file.download_url).then(r => r.text());
          const lines = raw.split("\n");
          let ev = {};
          lines.forEach(line => {
            if (line.startsWith("title:")) ev.title = line.replace("title:", "").trim();
            if (line.startsWith("date:")) ev.date = new Date(line.replace("date:", "").trim());
            if (line.startsWith("location:")) ev.location = line.replace("location:", "").trim();
            if (line.startsWith("location_url:")) ev.location_url = line.replace("location_url:", "").trim();
          });
          ev.description = marked.parse(raw.split("---").pop().trim());
          events.push(ev);
        }
      }

      // ‡§´‡§ï‡•ç‡§§ ‡§Ø‡•á‡§£‡§æ‡§∞‡•á ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ ‡§¶‡§æ‡§ñ‡§µ‡§æ
      const today = new Date();
      events = events.filter(e => e.date >= today);
      events.sort((a, b) => a.date - b.date);

      const container = document.getElementById("events");
      container.innerHTML = "";
      let delay = 0.2;

      events.forEach(ev => {
        const div = document.createElement("div");
        div.className = "event";
        div.style.animationDelay = `${delay}s`;
        delay += 0.2;

        div.innerHTML = `
          <h3>${ev.title}</h3>
          <p><strong>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</strong> ${ev.date.toLocaleDateString("mr-IN", { day: "numeric", month: "long", year: "numeric" })}</p>
          <p><strong>‡§†‡§ø‡§ï‡§æ‡§£:</strong> ${ev.location}</p>
          <p><strong>‡§®‡§ï‡§æ‡§∂‡§æ:</strong> <a href="${ev.location_url}" target="_blank">Google Map</a></p>
          <p><strong>‡§µ‡§ø‡§µ‡§∞‡§£:</strong> ${ev.description}</p>
        `;
        container.appendChild(div);
      });
    }

    loadEvents();

    // ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§≤‡•â‡§ú‡§ø‡§ï
    const searchInput = document.getElementById("searchInput");
    const dateFilter = document.getElementById("dateFilter");
    const clearBtn = document.getElementById("clearBtn");

    function filterEvents() {
      const searchValue = searchInput.value.toLowerCase();
      const selectedDate = dateFilter.value;

      document.querySelectorAll(".event").forEach(event => {
        const text = event.innerText.toLowerCase();
        let matchesSearch = text.includes(searchValue);
        let matchesDate = !selectedDate || event.innerText.includes(selectedDate);

        event.style.display = (matchesSearch && matchesDate) ? "block" : "none";
      });
    }

    searchInput.addEventListener("keyup", filterEvents);
    dateFilter.addEventListener("change", filterEvents);
    clearBtn.addEventListener("click", () => {
      searchInput.value = "";
      dateFilter.value = "";
      document.querySelectorAll(".event").forEach(event => event.style.display = "block");
    });
  </script>
</body>
</html>
