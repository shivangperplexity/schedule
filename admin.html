<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>दौरा कार्यक्रम Admin</title>
<style>
body{margin:0;font-family:"Noto Sans Devanagari",sans-serif;background:#f7f7f7;padding:20px;}
h2,h3{text-align:center;color:#e65100;}
form{max-width:500px;margin:auto;display:flex;flex-direction:column;gap:10px;}
input,textarea,button{padding:10px;font-size:16px;border-radius:8px;border:1px solid #ccc;outline:none;}
input:focus,textarea:focus{border-color:#e65100;box-shadow:0 0 5px rgba(230,81,0,0.5);}
button{background:#e65100;color:white;border:none;cursor:pointer;font-weight:bold;}
button:hover{background:#bf360c;}
.event-list{max-width:700px;margin:20px auto;}
.event-item{background:white;padding:10px;margin-bottom:10px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center;}
</style>
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>

<h2>दौरा कार्यक्रम व्यवस्थापक</h2>

<div id="login-section" style="text-align:center;">
<button id="login-btn">लॉगिन</button>
</div>

<div id="admin-section" style="display:none;">
<h3>नवीन कार्यक्रम जोडा</h3>
<form id="event-form">
<input type="text" name="title" placeholder="शीर्षक" required>
<input type="date" name="date" required>
<input type="text" name="place" placeholder="ठिकाण" required>
<input type="text" name="map_url" placeholder="Google नकाशा लिंक">
<textarea name="description" placeholder="विवरण"></textarea>
<button type="submit">जतन करा</button>
</form>

<div class="event-list" id="event-list"></div>
</div>

<script>
const identity = netlifyIdentity;
identity.on('init', user=>{
  if(user){
    document.getElementById('login-section').style.display='none';
    document.getElementById('admin-section').style.display='block';
    loadEvents();
  }
});
identity.on('login', user=>location.reload());
identity.on('logout', ()=>location.reload());

document.getElementById('login-btn').addEventListener('click', ()=>identity.open());

const form = document.getElementById('event-form');
form.addEventListener('submit', async e=>{
  e.preventDefault();
  const data = Object.fromEntries(new FormData(form));
  const res = await fetch('/.netlify/functions/save-events',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify(data)
  });
  if(res.ok){ alert('कार्यक्रम जतन झाला!'); loadEvents(); form.reset(); }
  else alert('त्रुटी');
});

async function loadEvents(){
  const res = await fetch('/events.json');
  const events = await res.json();
  const list = document.getElementById('event-list');
  list.innerHTML='';
  events.forEach((e,i)=>{
    const div = document.createElement('div');
    div.className='event-item';
    div.innerHTML=`<span>${e.title} - ${e.date}</span>
      <button onclick="deleteEvent(${i})">डिलीट</button>`;
    list.appendChild(div);
  });
}

async function deleteEvent(index){
  const res = await fetch('/.netlify/functions/save-events',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({deleteIndex:index})
  });
  if(res.ok){ alert('कार्यक्रम हटवला!'); loadEvents(); }
  else alert('त्रुटी');
}
</script>

</body>
</html>
